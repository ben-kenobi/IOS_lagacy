<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">

    <title>(译)KVO的内部实现 - CocoaChina_让移动开发更简单</title>
    <meta name="keywords" content="KVOiPhone开发,iOS开发,iPad开发,Mac开发,苹果开发中文站,iPhone开发中文站,CocoaChina首页, Mac OS开发, Cocoa介绍,移动互联网,触控科技,Cocoa,Apple,developer,iOS,iPhone,iPad,iMac,iPod Touch,iPhone5,iPhone4S,iPad3,招聘,iPhone程序员,Objective-c,iPhone应用外包,ios6,ios面试,Cocos2d-x,cocos2d,iTunes,App Store,苹果开发">
    <meta name="description" content="CocoaChina前身是全球成立最早规模最大的苹果开发中文站，现致力为所有移动开发者提供资讯服务、问答服务、代码下载、工具库及人才招聘服务">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="baidu-tc-cerfication" content="3300a939a1098c27e94457b75a0bb8c1">
    <script src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/jquery_002.js" async="" type="text/javascript"></script><script src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/analytics.js" async=""></script><script src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/hm.js"></script><script src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/ga.js" async="" type="text/javascript"></script><script src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/analytics.js" async=""></script><script src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/ca-pub-1180518835303646.js" type="text/javascript" async=""></script><script type="text/javascript">
        function gotoMobilePage() {
            var sUserAgent = navigator.userAgent.toLowerCase();
            var agent_iphone = /iphone/i;
            var agent_android = /android/i;
            //var agent_ipad = /ipad/i;
            var agent_ipod = /ipod/i;
            var agent_wphone = /windows phone/i;
            if(agent_iphone.test(sUserAgent) || agent_android.test(sUserAgent) || agent_ipod.test(sUserAgent) || agent_wphone.test(sUserAgent)){
                var re = /\/\w+\/\d+\/(\d+)\.html/, 
                    result = re.exec(window.location.pathname);
                if ( result )
                {
                    window.location.href = "http://www.cocoachina.com/cms/wap.php?action=article&id=" + result[1];
                } else {
                    window.location.href = "http://m.cocoachina.com/";
                }
            }
        }
        gotoMobilePage(); 
    </script>
    <link rel="stylesheet" href="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/global.css" media="all">
    <link rel="stylesheet" href="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/index.css" media="all">
    <link href="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/module.css" rel="stylesheet">
    <link href="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/style.css" rel="stylesheet">
    <link href="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/navheader.css" rel="stylesheet">
    <script src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/jquery.js" type="text/javascript"></script>
    <script type="text/javascript" src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/navbar.js"></script>
    <script type="text/javascript" src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/abase.js"></script><script type="text/javascript" charset="gbk" src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/prebat.js"></script>
    
<script src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/share.js"></script><link href="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/share_style1_32.css" rel="stylesheet"></head>
<body>

    <div class="nav-header">
            <div class="nav-header-top">
                <div class="nav-logo nav-fl"><a href="http://www.cocoachina.com/"><img src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/logo.png"></a></div>
                <div class="nav-list nav-fl">
                    <ul>
                        <li><a href="http://www.cocoachina.com/news/">资讯</a></li>
                        <li><a href="http://www.cocoachina.com/bbs/">论坛</a></li>
                        <li><a target="_blank" href="http://code.cocoachina.com/" title="CODE">代码</a></li>
                        <li><a target="_blank" href="http://job.cocoachina.com/" title="JOB">招聘</a></li>
                        <li><a target="_blank" href="http://cvp.cocos.com/" title="CVP">CVP</a></li>
                    </ul>
                </div>
                <div class="nav-search nav-fl">
                    <div class="nav-search-flag" style="display:block"><img src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/search-icon.png"></div>
                    <div class="nav-search-form" style="display:none">
                        <form action="/cms/plus/search.php" name="formsearch" method="post" target="_blank">
                            <input name="kwtype" value="0" type="hidden">
                            <input name="searchtype" value="titlekeyword" type="hidden">
                            <input name="keyword" placeholder="站内搜索" type="text">
                            <input type="button">
                        </form>
                    </div>
                </div>
                <div class="nav-user nav-fr">
                    <!-- #region 未登录时显示此区域 -->
                    <div class="nav-user-login" style="display:block">
                        <a href="http://www.cocoachina.com/bbs/login.php">登录</a>|
                        <a href="http://www.cocoachina.com/bbs/register.php">注册</a>
                    </div>
                    <!-- #endregion -->
                    <!-- #region 已登录时显示此区域 -->
                    <div class="nav-user-name" style="display:none">
                        <div><alert></alert><img src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/user.png">Guest</div>
                        <ul>
                            <li><a href="#"><img src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/i-man.png">我的主页</a></li>
                            <li><alert></alert><a href="#"><img src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/i-mail.png">我的消息</a></li>
                            <li><a href="#"><img src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/i-setting.png">账户设置</a></li>
                            <li><a href="http://www.cocoachina.com/ios/20140107/index-offline.html"><img src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/i-logout.png">退出</a></li>
                        </ul>
                    </div>
                    <!-- #endregion -->
                </div>
                <div class="nav-clear"></div>
            </div>
        <div class="nav-header-bottom">
            <ul>
                <li><a class="light" id="ios" href="http://www.cocoachina.com/ios/" title="ios">iOS开发</a></li>
                <li><a id="swift" href="http://www.cocoachina.com/swift/" title="swift">Swift</a></li>
                <li><a id="app_store" href="http://www.cocoachina.com/appstore/" title="appstore">App Store研究</a></li>
                <li><a id="design" href="http://www.cocoachina.com/design/" title="design">产品设计</a></li>
                <li><a id="review" href="http://www.cocoachina.com/review/" title="review">应用评测</a></li>
                <li><a id="game" href="http://www.cocoachina.com/game/" title="game">游戏开发</a></li>
                <li><a id="apple" href="http://www.cocoachina.com/apple/" title="apple">苹果相关</a></li>
                <!-- <li><a id="cocos" href="/cocos/" title="cocos">Cocos引擎</a></li>-->
                <li><a id="webapp" href="http://www.cocoachina.com/webapp/" title="webapp">WebApp</a></li>
                <li><a id="android" href="http://www.cocoachina.com/android/" title="android">安卓相关</a></li>
                <li><a id="market" href="http://www.cocoachina.com/market/" title="market">营销推广</a></li>
                <li><a id="industry" href="http://www.cocoachina.com/industry/" title="industry">业界动态</a></li>
                <li><a id="programmer" href="http://www.cocoachina.com/programmer/" title="programmer">程序人生</a></li>
            </ul>
        </div>
    </div>
<script language="javascript">
    function IsPC() {
        var userAgentInfo = navigator.userAgent;
        var Agents = new Array("Android", "iPhone", "SymbianOS", "Windows Phone", "iPod");
        var flag = true;
        for (var v = 0; v < Agents.length; v++) {
        if (userAgentInfo.indexOf(Agents[v]) > 0) { flag = false; break; }
        }
        return flag;
    }
    if (!IsPC()){
           window.location.href = "http://www.cocoachina.com/cms/wap.php?action=article&id=7667";
    }

</script>
<!--middle-->
<div class="middle clearfix">
    <div class="m-wrap">
        <div class="m-ad2" style="margin-top:12px;">
            <div class="ad2-l">
                <script async="" src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/adsbygoogle.js"></script>
                <!-- CC首页底部左侧72890 -->
                <ins data-adsbygoogle-status="done" class="adsbygoogle" style="display:inline-block;width:728px;height:90px" data-ad-client="ca-pub-1180518835303646" data-ad-slot="8012423965"><ins id="aswift_0_expand" style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent"><ins id="aswift_0_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:728px;background-color:transparent"><iframe marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;" frameborder="0" height="90" width="728"></iframe></ins></ins></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
            <div class="ad2-r">
                <script async="" src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/adsbygoogle.js"></script>
                <!-- CC资讯页25090 -->
                <ins data-adsbygoogle-status="done" class="adsbygoogle" style="display:inline-block;width:250px;height:90px" data-ad-client="ca-pub-1180518835303646" data-ad-slot="9489157162"><ins id="aswift_1_expand" style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:250px;background-color:transparent"><ins id="aswift_1_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:250px;background-color:transparent"><iframe marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_1" name="aswift_1" style="left:0;position:absolute;top:0;" frameborder="0" height="90" width="250"></iframe></ins></ins></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
        </div>
        <!--left-->
        <div class="detail-left float-l">
            <p class="crumbs"><a href="http://www.cocoachina.com/" title="首页">首页</a> &gt;<a href="http://www.cocoachina.com/ios" title="iOS开发"><span id="type_name">iOS开发</span></a></p>
            <div class="detail-main">
                <h2>(译)KVO的内部实现</h2>
                <div class="p-ico clearfix">
                    <div>
                        <span class="ml0">2014-01-07 16:52</span>
                        <span>编辑：
                        <a href="http://www.cocoachina.com/bbs/u.php?action=feed&amp;uid=340873" id="field_author" target="_blank">suiling</a></span>
                        <span>分类：<a href="http://www.cocoachina.com/ios/" target="_blank">iOS开发</a></span>
                        <span id="source">来源：CocoaChina</span>

                        <div class="float-r">
                            <span id="artical_comment_cnt"><i></i>0</span>
                            <span><i class="view"></i><script src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/count.html" language="javascript"></script>9019</span>
                    </div>
                    </div>
                </div>
                <div class="p-ico clearfix">
                    <p class="related float-l"><a href="http://www.cocoachina.com/cms/tags.php?/KVO/" target="_blank">KVO</a></p>
                    <input id="article_id" value="7667" type="hidden">
                </div>
                <div class="adsbox clearfix">
                    <div class="float-l">
                        <div class="float-l"><b>招聘信息：</b></div>
                        <ul class="float-l" id="invitelist" style="margin-top: 0px;"><li><a href="http://job.cocoachina.com/job/show?id=67275" target="_blank">安卓开发工程师</a></li><li><a href="http://job.cocoachina.com/job/show?id=67274" target="_blank">iOS工程师</a></li><li><a href="http://job.cocoachina.com/job/show?id=67276" target="_blank">PHP开发工程师</a></li><li><a href="http://job.cocoachina.com/job/show?id=67356" target="_blank">iOS工程师</a></li><li><a href="http://job.cocoachina.com/job/show?id=67159" target="_blank">iOS开发工程师</a></li><li><a href="http://job.cocoachina.com/job/show?id=66873" target="_blank">iOS开发工程师</a></li><li><a href="http://job.cocoachina.com/job/show?id=67264" target="_blank">资深iOS工程师</a></li><li><a href="http://job.cocoachina.com/job/show?id=65299" target="_blank">iOS高级开发工程师</a></li><li><a href="http://job.cocoachina.com/job/show?id=67188" target="_blank">iOS高级开发工程师</a></li><li><a href="http://job.cocoachina.com/job/show?id=66967" target="_blank">手游JAVA 服务器端主程</a></li><li><a href="http://job.cocoachina.com/job/show?id=66966" target="_blank">cocos2dx手游客户端主程</a></li></ul>
                    </div>
                    <div class="float-r">
                        <a href="javascript:void(0)" class="prev"></a>
                        <a href="javascript:void(0)" class="next"></a>
                    </div>
                </div>
                <div id="detailbody" class="field_body">
                    <div>09年的一篇文章，比较深入地阐述了KVO的内部实现。</div>
<div>&nbsp;</div>
<div>KVO是实现Cocoa Bindings的基础，它提供了一种方法，当某个属性改变时，相应的objects会被通知到。在其他语言中，这种观察者模式通常需要单独实现，而在Objective-C中，通常无须增加额外代码即可使用。</div>
<div>&nbsp;</div>
<div><strong>概览</strong></div>
<div>这是怎么实现的呢？其实这都是通过Objective-C强大的运行时(runtime)实现的。当你第一次观察某个object
时，runtime会创建一个新的继承原先class的subclass。在这个新的class中，它重写了所有被观察的key，然后将object的
isa指针指向新创建的class（这个指针告诉Objective-C运行时某个object到底是哪种类型的object）。所以object神奇地
变成了新的子类的实例。</div>
<div>&nbsp;</div>
<div>这些被重写的方法实现了如何通知观察者们。当改变一个key时，会触发setKey方法，但这个方法被重写了，并且在内部添加了发送通知机制。（当然也可以不走setXXX方法，比如直接修改iVar，但不推荐这么做）。</div>
<div>&nbsp;</div>
<div>有意思的是：苹果不希望这个机制暴露在外部。除了setters，这个动态生成的子类同时也重写了-class方法，依旧返回原先的class！如果不仔细看的话，被KVO过的object看起来和原先的object没什么两样。</div>
<div>&nbsp;</div>
<div><strong>深入探究</strong></div>
<div>下面来看看这些是如何实现的。我写了个程序来演示隐藏在KVO背后的机制。</div>
<pre><ol class="dp-c"><li class="alt"><span><span class="comment">//&nbsp;gcc&nbsp;-o&nbsp;kvoexplorer&nbsp;-framework&nbsp;Foundation&nbsp;kvoexplorer.m</span><span>&nbsp;</span></span></li><li><span><span class="preprocessor">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;</span></li><li class="alt"><span><span class="preprocessor">#import&nbsp;<foundation foundation.h=""></foundation></span><span>&nbsp;</span></span></li><li><span><span class="preprocessor">#import&nbsp;<objc runtime.h=""></objc></span><span>&nbsp;</span></span></li><li class="alt"><span>&nbsp;</span></li><li><span>&nbsp;</span></li><li class="alt"><span>@<span class="keyword">interface</span><span>&nbsp;TestClass&nbsp;:&nbsp;NSObject&nbsp;</span></span></li><li><span>{&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;x;&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;y;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">int</span><span>&nbsp;z;&nbsp;</span></span></li><li><span>}&nbsp;</span></li><li class="alt"><span>@property&nbsp;<span class="keyword">int</span><span>&nbsp;x;&nbsp;</span></span></li><li><span>@property&nbsp;<span class="keyword">int</span><span>&nbsp;y;&nbsp;</span></span></li><li class="alt"><span>@property&nbsp;<span class="keyword">int</span><span>&nbsp;z;&nbsp;</span></span></li><li><span>@end&nbsp;</span></li><li class="alt"><span>&nbsp;</span></li><li><span>@implementation&nbsp;TestClass&nbsp;</span></li><li class="alt"><span>@synthesize&nbsp;x,&nbsp;y,&nbsp;z;&nbsp;</span></li><li><span>@end&nbsp;</span></li><li class="alt"><span>&nbsp;</span></li><li><span><span class="keyword">static</span><span>&nbsp;NSArray&nbsp;*ClassMethodNames(Class&nbsp;c)&nbsp;</span></span></li><li class="alt"><span>{&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;NSMutableArray&nbsp;*array&nbsp;=&nbsp;[NSMutableArray&nbsp;array];&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;<span class="keyword">int</span><span>&nbsp;methodCount&nbsp;=&nbsp;0;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;Method&nbsp;*methodList&nbsp;=&nbsp;class_copyMethodList(c,&nbsp;&amp;methodCount);&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;<span class="keyword">int</span><span>&nbsp;i;&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span><span>(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;methodCount;&nbsp;i++)&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[array&nbsp;addObject:&nbsp;NSStringFromSelector(method_getName(methodList[i]))];&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;free(methodList);&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;array;&nbsp;</span></span></li><li><span>}&nbsp;</span></li><li class="alt"><span>&nbsp;</span></li><li><span><span class="keyword">static</span><span>&nbsp;</span><span class="keyword">void</span><span>&nbsp;PrintDescription(NSString&nbsp;*name,&nbsp;id&nbsp;obj)&nbsp;</span></span></li><li class="alt"><span>{&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;NSString&nbsp;*str&nbsp;=&nbsp;[NSString&nbsp;stringWithFormat:&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="string">"%@:&nbsp;%@\n\tNSObject&nbsp;class&nbsp;%s\n\tlibobjc&nbsp;class&nbsp;%s\n\timplements&nbsp;methods&nbsp;&lt;%@&gt;"</span><span>,&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name,&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;obj,&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class_getName([obj&nbsp;<span class="keyword">class</span><span>]),&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class_getName(obj-&gt;isa),&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ClassMethodNames(obj-&gt;isa)&nbsp;componentsJoinedByString:@<span class="string">",&nbsp;"</span><span>]];&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;printf(<span class="string">"%s\n"</span><span>,&nbsp;[str&nbsp;UTF8String]);&nbsp;</span></span></li><li><span>}&nbsp;</span></li><li class="alt"><span>&nbsp;</span></li><li><span><span class="keyword">int</span><span>&nbsp;main(</span><span class="keyword">int</span><span>&nbsp;argc,&nbsp;</span><span class="keyword">char</span><span>&nbsp;**argv)&nbsp;</span></span></li><li class="alt"><span>{&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;[NSAutoreleasePool&nbsp;<span class="keyword">new</span><span>];&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;TestClass&nbsp;*x&nbsp;=&nbsp;[[TestClass&nbsp;alloc]&nbsp;init];&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;TestClass&nbsp;*y&nbsp;=&nbsp;[[TestClass&nbsp;alloc]&nbsp;init];&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;TestClass&nbsp;*xy&nbsp;=&nbsp;[[TestClass&nbsp;alloc]&nbsp;init];&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;TestClass&nbsp;*control&nbsp;=&nbsp;[[TestClass&nbsp;alloc]&nbsp;init];&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;[x&nbsp;addObserver:x&nbsp;forKeyPath:@<span class="string">"x"</span><span>&nbsp;options:0&nbsp;context:NULL];&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;[xy&nbsp;addObserver:xy&nbsp;forKeyPath:@<span class="string">"x"</span><span>&nbsp;options:0&nbsp;context:NULL];&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;[y&nbsp;addObserver:y&nbsp;forKeyPath:@<span class="string">"y"</span><span>&nbsp;options:0&nbsp;context:NULL];&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;[xy&nbsp;addObserver:xy&nbsp;forKeyPath:@<span class="string">"y"</span><span>&nbsp;options:0&nbsp;context:NULL];&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;PrintDescription(@<span class="string">"control"</span><span>,&nbsp;control);&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;PrintDescription(@<span class="string">"x"</span><span>,&nbsp;x);&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;PrintDescription(@<span class="string">"y"</span><span>,&nbsp;y);&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;PrintDescription(@<span class="string">"xy"</span><span>,&nbsp;xy);&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;printf(<span class="string">"Using&nbsp;NSObject&nbsp;methods,&nbsp;normal&nbsp;setX:&nbsp;is&nbsp;%p,&nbsp;overridden&nbsp;setX:&nbsp;is&nbsp;%p\n"</span><span>,&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[control&nbsp;methodForSelector:@selector(setX:)],&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[x&nbsp;methodForSelector:@selector(setX:)]);&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;printf(<span class="string">"Using&nbsp;libobjc&nbsp;functions,&nbsp;normal&nbsp;setX:&nbsp;is&nbsp;%p,&nbsp;overridden&nbsp;setX:&nbsp;is&nbsp;%p\n"</span><span>,&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method_getImplementation(class_getInstanceMethod(object_getClass(control),&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@selector(setX:))),&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method_getImplementation(class_getInstanceMethod(object_getClass(x),&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@selector(setX:))));&nbsp;</span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span><span>&nbsp;0;&nbsp;</span></span></li><li class="alt"><span>}&nbsp;</span></li></ol></pre>
<div>&nbsp;</div>
<div>我们从头到尾细细看来。</div>
<div>&nbsp;</div>
<div>首先定义了一个TestClass的类，它有3个属性。</div>
<div>&nbsp;</div>
<div>然后定义了一些方便调试的方法。ClassMethodNames使用Objective-C运行时方法来遍历一个class，得到方法列表。
注意，这些方法不包括父类的方法。PrintDescription打印object的所有信息，包括class信息（包括-class和通过运行时得到
的class），以及这个class实现的方法。</div>
<div>&nbsp;</div>
<div>然后创建了4个TestClass实例，每一个都使用了不同的观察方式。x实例有一个观察者观察xkey，y, xy也类似。为了做比较，zkey没有观察者。最后control实例没有任何观察者。</div>
<div>&nbsp;</div>
<div>然后打印出4个objects的description。</div>
<div>&nbsp;</div>
<div>之后继续打印被重写的setter内存地址，以及未被重写的setter的内存地址做比较。这里做了两次，是因为
-methodForSelector:没能得到重写的方法。KVO试图掩盖它实际上创建了一个新的subclass这个事实！但是使用运行时的方法就原
形毕露了。</div>
<div>&nbsp;</div>
<div><strong>运行代码</strong></div>
<div>&nbsp;</div>
<div>看看这段代码的输出</div>
<pre><ol class="dp-c"><li class="alt"><span><span>control:&nbsp;<testclass:&nbsp;0x104b20>&nbsp;</testclass:&nbsp;0x104b20></span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;NSObject&nbsp;<span class="keyword">class</span><span>&nbsp;TestClass&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;libobjc&nbsp;<span class="keyword">class</span><span>&nbsp;TestClass&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">implements</span><span>&nbsp;methods&nbsp;<setx:,&nbsp;x,&nbsp;sety:,&nbsp;y,&nbsp;setz:,&nbsp;z>&nbsp;</setx:,&nbsp;x,&nbsp;sety:,&nbsp;y,&nbsp;setz:,&nbsp;z></span></span></li><li class="alt"><span>x:&nbsp;<testclass:&nbsp;0x103280>&nbsp;</testclass:&nbsp;0x103280></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;NSObject&nbsp;<span class="keyword">class</span><span>&nbsp;TestClass&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;libobjc&nbsp;<span class="keyword">class</span><span>&nbsp;NSKVONotifying_TestClass&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">implements</span><span>&nbsp;methods&nbsp;<sety:,&nbsp;setx:,&nbsp;< span=""><span class="keyword">class</span><span>,&nbsp;dealloc,&nbsp;_isKVOA&gt;&nbsp;</span></sety:,&nbsp;setx:,&nbsp;<></span></span></li><li class="alt"><span>y:&nbsp;<testclass:&nbsp;0x104b00>&nbsp;</testclass:&nbsp;0x104b00></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;NSObject&nbsp;<span class="keyword">class</span><span>&nbsp;TestClass&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;libobjc&nbsp;<span class="keyword">class</span><span>&nbsp;NSKVONotifying_TestClass&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">implements</span><span>&nbsp;methods&nbsp;<sety:,&nbsp;setx:,&nbsp;< span=""><span class="keyword">class</span><span>,&nbsp;dealloc,&nbsp;_isKVOA&gt;&nbsp;</span></sety:,&nbsp;setx:,&nbsp;<></span></span></li><li class="alt"><span>xy:&nbsp;<testclass:&nbsp;0x104b10>&nbsp;</testclass:&nbsp;0x104b10></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;NSObject&nbsp;<span class="keyword">class</span><span>&nbsp;TestClass&nbsp;</span></span></li><li class="alt"><span>&nbsp;&nbsp;&nbsp;&nbsp;libobjc&nbsp;<span class="keyword">class</span><span>&nbsp;NSKVONotifying_TestClass&nbsp;</span></span></li><li><span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">implements</span><span>&nbsp;methods&nbsp;<sety:,&nbsp;setx:,&nbsp;< span=""><span class="keyword">class</span><span>,&nbsp;dealloc,&nbsp;_isKVOA&gt;&nbsp;</span></sety:,&nbsp;setx:,&nbsp;<></span></span></li><li class="alt"><span>Using&nbsp;NSObject&nbsp;methods,&nbsp;normal&nbsp;setX:&nbsp;is&nbsp;0x195e,&nbsp;overridden&nbsp;setX:&nbsp;is&nbsp;0x195e&nbsp;</span></li><li><span>Using&nbsp;libobjc&nbsp;functions,&nbsp;normal&nbsp;setX:&nbsp;is&nbsp;0x195e,&nbsp;overridden&nbsp;setX:&nbsp;is&nbsp;0x96a1a550&nbsp;</span></li></ol></pre>
<div>&nbsp;</div>
<div>首先，它输出了controlobject，没有任何问题，它的class是TestClass，并且实现了6个set/get方法。</div>
<div>&nbsp;</div>
<div>然后是3个被观察的objects。注意-class仍然显示的是TestClass，使用object_getClass显示了这个
object的真面目：它是NSKVONotifying_TestClass的一个实例。这个NSKVONotifying_TestClass就是动
态生成的subclass！</div>
<div>&nbsp;</div>
<div>注意，它是如何实现这两个被观察的setters的。你会发现，它很聪明，没有重写-setZ:，虽然它也是个setter，因为它没有被观
察。同时注意到，3个实例对应的是同一个class，也就是说两个setters都被重写了，尽管其中的两个实例只观察了一个属性。这会带来一点效率上的
问题，因为即使没有被观察的property也会走被重写的setter，但苹果显然觉得这比分开生成动态的subclass更好，我也觉得这是个正确的
选择。</div>
<div>&nbsp;</div>
<div>你会看到3个其他的方法。有之前提到过的被重写的-class方法，假装自己还是原来的class。还有-dealloc方法处理一些收尾工作。还有一个_isKVOA方法，看起来像是一个私有方法。</div>
<div>&nbsp;</div>
<div>接下来，我们输出-setX:的实现。使用-methodForSelector:返回的是相同的值。因为-setX:已经在子类被重写了，这也就意味着methodForSelector:在内部实现中使用了-class，于是得到了错误的结果。</div>
<div>&nbsp;</div>
<div>最后我们通过运行时得到了不同的输出结果。</div>
<div>&nbsp;</div>
<div>作为一个优秀的探索者，我们进入debugger来看看这第二个方法的实现到底是怎样的：</div>
<pre><ol class="dp-c"><li class="alt"><span><span>(gdb)&nbsp;print&nbsp;(IMP)0x96a1a550&nbsp;</span></span></li><li><span>$1&nbsp;=&nbsp;(IMP)&nbsp;0x96a1a550&nbsp;&lt;_NSSetIntValueAndNotify&gt;&nbsp;</span></li></ol></pre>
<div>&nbsp;</div>
<div>看起来是一个内部方法，对Foundation使用nm -a得到一个完整的私有方法列表：</div>
<pre><ol class="dp-c"><li class="alt"><span><span>0013df80&nbsp;t&nbsp;__NSSetBoolValueAndNotify&nbsp;</span></span></li><li><span>000a0480&nbsp;t&nbsp;__NSSetCharValueAndNotify&nbsp;</span></li><li class="alt"><span>0013e120&nbsp;t&nbsp;__NSSetDoubleValueAndNotify&nbsp;</span></li><li><span>0013e1f0&nbsp;t&nbsp;__NSSetFloatValueAndNotify&nbsp;</span></li><li class="alt"><span>000e3550&nbsp;t&nbsp;__NSSetIntValueAndNotify&nbsp;</span></li><li><span>0013e390&nbsp;t&nbsp;__NSSetLongLongValueAndNotify&nbsp;</span></li><li class="alt"><span>0013e2c0&nbsp;t&nbsp;__NSSetLongValueAndNotify&nbsp;</span></li><li><span>00089df0&nbsp;t&nbsp;__NSSetObjectValueAndNotify&nbsp;</span></li><li class="alt"><span>0013e6f0&nbsp;t&nbsp;__NSSetPointValueAndNotify&nbsp;</span></li><li><span>0013e7d0&nbsp;t&nbsp;__NSSetRangeValueAndNotify&nbsp;</span></li><li class="alt"><span>0013e8b0&nbsp;t&nbsp;__NSSetRectValueAndNotify&nbsp;</span></li><li><span>0013e550&nbsp;t&nbsp;__NSSetShortValueAndNotify&nbsp;</span></li><li class="alt"><span>0008ab20&nbsp;t&nbsp;__NSSetSizeValueAndNotify&nbsp;</span></li><li><span>0013e050&nbsp;t&nbsp;__NSSetUnsignedCharValueAndNotify&nbsp;</span></li><li class="alt"><span>0009fcd0&nbsp;t&nbsp;__NSSetUnsignedIntValueAndNotify&nbsp;</span></li><li><span>0013e470&nbsp;t&nbsp;__NSSetUnsignedLongLongValueAndNotify&nbsp;</span></li><li class="alt"><span>0009fc00&nbsp;t&nbsp;__NSSetUnsignedLongValueAndNotify&nbsp;</span></li><li><span>0013e620&nbsp;t&nbsp;__NSSetUnsignedShortValueAndNotify&nbsp;</span></li></ol></pre>
<div>这个列表也能发现一些有趣的东西。比如苹果为每一种primitive 
type都写了对应的实现。Objective-C的object会用到的其实只有__NSSetObjectValueAndNotify，但需要一整
套来对应剩下的，而且看起来也没有实现完全，比如long dobule或_Bool都没有。甚至没有为通用指针类型(generic pointer 
type)提供方法。所以，不在这个方法列表里的属性其实是不支持KVO的。</div>
<div>&nbsp;</div>
<div>KVO是一个很强大的工具，有时候过于强大了，尤其是有了自动触发通知机制。现在你知道它内部是怎么实现的了，这些知识或许能帮助你更好地使用它，或在它出错时更方便调试。</div>
<div>&nbsp;</div>
<div>如果你打算使用KVO，或许可以看一下我的另一篇文章<a href="https://www.mikeash.com/pyblog/key-value-observing-done-right.html" target="_blank"><span style="color: rgb(0, 0, 255);">Key-Value Observing Done Right</span></a></div>
<div>&nbsp;</div>
<div>来源：<a href="http://blog.leezhong.com/ios/2013/08/05/internal-implementation-of-kvo.html" target="_blank"><span style="color: rgb(0, 0, 255);">无网不剩的博客</span></a></div>
                </div>
                <div id="page" style="padding:0"></div>

                <div class="wx_article">
                    <div class="article_weixin">
                        <img src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/article_weixin.jpg" alt="搜索CocoaChina微信公众号：CocoaChina" height="131" width="131">
                        <div class="article_scan">微信扫一扫</div>
                        <div class="article_txt"><span style="color:#999999">订阅每日移动开发及APP推广热点资讯<br>公众号：</span>CocoaChina</div>
                    </div>
                </div>

               <div class="clearfix tgbox">
                    <a href="mailto:support@cocoachina.com" class="tg float-l" target="_blank">我要投稿</a>&nbsp;&nbsp;
                    <a style="margin-left:10px" href="javascript:void(0)" onclick="add_favors(7667,'(译)KVO的内部实现')" class="tg float-l">收藏文章</a>
                    <div class="share float-r">分享到：
                        <div data-bd-bind="1447601563467" class="bdsharebuttonbox bdshare-button-style1-32" id="sharediv"><a href="#" class="bds_more" data-cmd="more"></a> <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a> <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a></div>
                    </div>
                </div>


                <a class="zanbox" href="javascript:void(0)" id="zanbox" onclick="postDigg('good',7667)" title="哎呦，不错噢，赞一个">
                    <strong id="newdigg">
                     <script src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/count_002.html" language="javascript"></script>31
                    </strong>
                </a>
            </div>

            <div class="article-prev">上一篇：<a href="http://www.cocoachina.com/ios/20140107/7664.html">论坛源码推荐（1月7日）：App动态代码注入工具  灵活裁剪多边形图片</a> </div>
            <div class="article-next">下一篇：<a href="http://www.cocoachina.com/ios/20140108/7674.html">谷歌分析iOS开发包实战</a> </div>

            <!--相关资讯-->
            <div class="part-wrap clearfix">
                <h3>相关资讯</h3>
                <ul class="info-list clearfix">
                    <li>
                        <a href="http://www.cocoachina.com/ios/20150826/13139.html" target="_blank" title="如果需要监听对象A属性B值的变化，我们通常会考虑用KVO来实现">Objective-C结合RAC实现KVO广播功能</a>
                     </li>
<li>
                        <a href="http://www.cocoachina.com/ios/20150313/11321.html" target="_blank" title="KVO 是 Objective-C 对观察者模式（Observer Pattern）的实现。也是 Cocoa Binding 的基础。当被观察对象的某个属性发生更改时，观察者对象会获得通知。">如何自己动手实现 KVO</a>
                     </li>
<li>
                        <a href="http://www.cocoachina.com/ios/20140624/8936.html" target="_blank" title="KVO(Key Value Observing)，是观察者模式在Foundation中的实现。KVO的原理简而言之就是：当一个object有观察者时，动态创建这个object的类的子类；">Objective-C KVO简单探索</a>
                     </li>
<li>
                        <a href="http://www.cocoachina.com/ios/20140227/7891.html" target="_blank" title="Facebook KVOController是在Cocoa时间测试键－值观察的基础上实现的，提供了简洁高级、线程安全的API。适用于iOS和OS X平台。">论坛源码推荐（2月27日）：Facebook KVOController  多功能报表控件</a>
                     </li>
<li>
                        <a href="http://www.cocoachina.com/ios/20140224/7866.html" target="_blank" title="Key Value Coding Key Value Coding是cocoa的一个标准组成部分，它能让我们可以通过name(key)的方式访问property, 不必调用明确的property accssor, 如我们有个property叫做foo, 我们可以foo直接访问它，同样我们也">iOS KVC &amp; KVO</a>
                     </li>
<li>
                        <a href="http://www.cocoachina.com/ios/20131106/7303.html" target="_blank" title="在这篇文章中，我会实现一个自己用的简单KVO类，我认为KVO非常棒，然而对于我大部分的使用场景来说，有这两个问题： 1. 我不喜欢在observeValueForKeyPath:ofObject:change:context:方法里通过keyPath值来">轻量级KVO[译]</a>
                     </li>
<li>
                        <a href="http://www.cocoachina.com/ios/20090611/221.html" target="_blank" title="KVC（Key-Value Coding）和KVO（Key-Value Observing）可能是Objective-C中最强大最实用的功能之一。 下面的几个例子可以帮你更好的理解它们。 原文作者： Marcus Zarra 原文地址 当通过KVC调用对象时">理解KVC与KVO（键-值-编码与键-值-监看）</a>
                     </li>

                </ul>
            </div>
            <div class="clearfix" style="margin-top:20px;">
                <script async="" src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/adsbygoogle.js"></script>
                <!-- CC评论框 -->
                <ins data-adsbygoogle-status="done" class="adsbygoogle" style="display:inline-block;width:750px;height:90px" data-ad-client="ca-pub-1180518835303646" data-ad-slot="8242010366"><ins id="aswift_2_expand" style="display:inline-table;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:750px;background-color:transparent"><ins id="aswift_2_anchor" style="display:block;border:none;height:90px;margin:0;padding:0;position:relative;visibility:visible;width:750px;background-color:transparent"><iframe marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_2" name="aswift_2" style="left:0;position:absolute;top:0;" frameborder="0" height="90" width="750"></iframe></ins></ins></ins>
                <script>
                    (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
            <!-- 评论模块start -->
            
            <div class="clearfix" id="commnet_list_holder" style="margin-bottom:50px;">
                <div class="glab-comment-form">
                    <div class="dcbt">我来说两句</div>
                    <div class="user-head">
                        <img id="user_face_url" src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/none.gif" alt="" height="43" width="43">
                    </div>
                    <div class="form-region">
                        <textarea name="comment" id="main_comment_content" cols="30" rows="10" placeholder="你怎么看？快来评论一下吧！"></textarea>
                        <a class="submitform" id="main_comment_bt">发表评论</a>
                        <div class="unlogin-mask">
                            <div>您还没有登录！请<a href="http://www.cocoachina.com/bbs/login.php">登录</a>或<a href="http://www.cocoachina.com/bbs/register.php">注册</a></div>
                        </div>
                    </div>
                </div>
                <div id="glab-comment-callback-msg" class="glab-comment-info"></div>
                <div class="glab-comment-title">所有评论（<span>0</span>）</div>
                <div class="glab-commentlist" id="commentlist">
                    <a style="display: none;" id="refresh_comment_btn" href="javascript:;" onclick="$('#morecomment').trigger('click')">刷新评论</a>
                </div>
                <div class="glab-comment-more" id="morecomment" style="display:none">
                    更多评论
                </div>
            </div>
            
            <!-- 评论模块end -->


        </div>
        <!--./left-->
        <!--侧边栏-->
        <div class="clearfix newslist">
            <div class="rightSide detail-right float-r">
                <!--两周热门资讯推荐-->
                <div>
                    <div class="part-wrap clearfix">
                        <h3>热门资讯</h3>
                        <ul class="related-hot">
                            <li class="clearfix"><a href="http://www.cocoachina.com/ios/20151106/14069.html" class="float-l pic" target="_blank" title="这些 iOS 面试基础题目，你都深入了解吗？"><img src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/f2e8444090ef4dffe19a4d07bc832770.jpg" style="max-height:60px" alt="这些 iOS 面试基础题目，你都深入了解吗？"></a><div style="margin-left:86px"><p class="related-intro"><a href="http://www.cocoachina.com/ios/20151106/14069.html" target="_blank" title="这些 iOS 面试基础题目，你都深入了解吗？">这些 iOS 面试基础题目，你都深入了解吗？</a></p><p class="hits">点击量<span>13866</span></p></div></li><li class="clearfix"><a href="http://www.cocoachina.com/ios/20151102/13924.html" class="float-l pic" target="_blank" title="Objective-C 的现代语法和新特性"><img src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/de203a522032c8f4ad784bf540af3f0c.jpg" style="max-height:60px" alt="Objective-C 的现代语法和新特性"></a><div style="margin-left:86px"><p class="related-intro"><a href="http://www.cocoachina.com/ios/20151102/13924.html" target="_blank" title="Objective-C 的现代语法和新特性">Objective-C 的现代语法和新特性</a></p><p class="hits">点击量<span>8411</span></p></div></li><li class="clearfix"><a href="http://www.cocoachina.com/ios/20151110/14102.html" class="float-l pic" target="_blank" title="【译】17个提升iOS开发效率的必用工具"><img src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/c81c182890d34b641a46c70c40dc63fd.jpg" style="max-height:60px" alt="【译】17个提升iOS开发效率的必用工具"></a><div style="margin-left:86px"><p class="related-intro"><a href="http://www.cocoachina.com/ios/20151110/14102.html" target="_blank" title="【译】17个提升iOS开发效率的必用工具">【译】17个提升iOS开发效率的必用工具</a></p><p class="hits">点击量<span>7805</span></p></div></li><li class="clearfix"><a href="http://www.cocoachina.com/webapp/20151030/13985.html" class="float-l pic" target="_blank" title="HTML5 崛起：不再高冷，不再小众"><img src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/60b513419316a145fa34aeb84d0556c3.jpg" style="max-height:60px" alt="HTML5 崛起：不再高冷，不再小众"></a><div style="margin-left:86px"><p class="related-intro"><a href="http://www.cocoachina.com/webapp/20151030/13985.html" target="_blank" title="HTML5 崛起：不再高冷，不再小众">HTML5 崛起：不再高冷，不再小众</a></p><p class="hits">点击量<span>6708</span></p></div></li><li class="clearfix"><a href="http://www.cocoachina.com/ios/20151110/14067.html" class="float-l pic" target="_blank" title="iOS开发——UI组件（个人整理）"><img src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/66d9d9ad083079d10170c91fe8c00bc6.jpg" style="max-height:60px" alt="iOS开发——UI组件（个人整理）"></a><div style="margin-left:86px"><p class="related-intro"><a href="http://www.cocoachina.com/ios/20151110/14067.html" target="_blank" title="iOS开发——UI组件（个人整理）">iOS开发——UI组件（个人整理）</a></p><p class="hits">点击量<span>6135</span></p></div></li><li class="clearfix"><a href="http://www.cocoachina.com/ios/20151103/14007.html" class="float-l pic" target="_blank" title="关于 @synchronized，这儿比你想知道的还要多"><img src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/d58e98c9208acf7654c3fc222f613354.jpg" style="max-height:60px" alt="关于 @synchronized，这儿比你想知道的还要多"></a><div style="margin-left:86px"><p class="related-intro"><a href="http://www.cocoachina.com/ios/20151103/14007.html" target="_blank" title="关于 @synchronized，这儿比你想知道的还要多">关于 @synchronized，这儿比你想知道的还要多</a></p><p class="hits">点击量<span>5855</span></p></div></li><li class="clearfix"><a href="http://www.cocoachina.com/ios/20151104/14009.html" class="float-l pic" target="_blank" title="【译】4个你需要知道的Asset Catalog的秘密"><img src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/6845edd2489ffa5b76d7d7a45a949177.jpg" style="max-height:60px" alt="【译】4个你需要知道的Asset Catalog的秘密"></a><div style="margin-left:86px"><p class="related-intro"><a href="http://www.cocoachina.com/ios/20151104/14009.html" target="_blank" title="【译】4个你需要知道的Asset Catalog的秘密">【译】4个你需要知道的Asset Catalog的秘密</a></p><p class="hits">点击量<span>5696</span></p></div></li><li class="clearfix"><a href="http://www.cocoachina.com/programmer/20151030/13949.html" class="float-l pic" target="_blank" title="程序员技术晋升非正式攻略"><img src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/68b634342adc09a46914d39a433b8a79.jpg" style="max-height:60px" alt="程序员技术晋升非正式攻略"></a><div style="margin-left:86px"><p class="related-intro"><a href="http://www.cocoachina.com/programmer/20151030/13949.html" target="_blank" title="程序员技术晋升非正式攻略">程序员技术晋升非正式攻略</a></p><p class="hits">点击量<span>4735</span></p></div></li><li class="clearfix"><a href="http://www.cocoachina.com/industry/20151111/14140.html" class="float-l pic" target="_blank" title="出大事了！A商要联合程序员们打淘宝分京东了！"><img src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/200787b3ae4ba49efb868a5ccb124084.png" style="max-height:60px" alt="出大事了！A商要联合程序员们打淘宝分京东了！"></a><div style="margin-left:86px"><p class="related-intro"><a href="http://www.cocoachina.com/industry/20151111/14140.html" target="_blank" title="出大事了！A商要联合程序员们打淘宝分京东了！">出大事了！A商要联合程序员们打淘宝分京东了！</a></p><p class="hits">点击量<span>4611</span></p></div></li><li class="clearfix noborder-b"><a href="http://www.cocoachina.com/ios/20151030/13975.html" class="float-l pic" target="_blank" title="【投稿】iOS自定义键盘"><img src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/fc7a4d8cb47eed70ad8ddb9624022fc6.jpg" style="max-height:60px" alt="【投稿】iOS自定义键盘"></a><div style="margin-left:86px"><p class="related-intro"><a href="http://www.cocoachina.com/ios/20151030/13975.html" target="_blank" title="【投稿】iOS自定义键盘">【投稿】iOS自定义键盘</a></p><p class="hits">点击量<span>4392</span></p></div></li>
                        </ul>
                    </div>
               </div>
               <!--./两周热门资讯推荐-->
                <!-- 广告位：资讯频道列表页面右侧300*90-->
                <div class="job-ad"><script>CNZZ_SLOT_RENDER('324555');</script><script type="text/javascript" charset="gbk" src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/appgcm_002.js"></script></div>
               <!--综合评论-->
                <div class="part-wrap clearfix" style="margin-top: 15px;">
                    <h3>综合评论</h3>
                    <ul class="related-comment clearfix" id="all_comments_holder"><li class=""><span class="hide_comment">算账算的好啊，你怎么就知道市场一定相信你，毕竟你已经不是第一个电商了，淘宝关门是早晚的事儿，但是也绝对不是你这理想主义就能推翻的啊</span><br><p><span>jianchuan0118</span><span>评论了</span><a target="_blank" title="因为A商，互联网的寒冬不再冷" href="http://www.cocoachina.com/industry/20151113/14204.html"><span>因为A商，互联网的寒冬不再冷...</span></a></p></li><li class=""><span class="hide_comment">挑战淘宝，挑战阿里巴巴？？别想了，洗洗睡吧！</span><br><p><span>andy2010</span><span>评论了</span><a target="_blank" title="因为A商，互联网的寒冬不再冷" href="http://www.cocoachina.com/industry/20151113/14204.html"><span>因为A商，互联网的寒冬不再冷...</span></a></p></li><li class=""><span class="hide_comment">gun </span><br><p><span>piao_</span><span>评论了</span><a target="_blank" title="因为A商，互联网的寒冬不再冷" href="http://www.cocoachina.com/industry/20151113/14204.html"><span>因为A商，互联网的寒冬不再冷...</span></a></p></li><li class=""><span class="hide_comment">mark</span><br><p><span>caodaxun</span><span>评论了</span><a target="_blank" title="Storyboard中的UIScrollView使用自动布局，使其能够滚动" href="http://www.cocoachina.com/ios/20150104/10810.html"><span>Storyboard中的UIScrollView使...</span></a></p></li><li class=""><span class="hide_comment">mark</span><br><p><span>caodaxun</span><span>评论了</span><a target="_blank" title="Storyboard中的UIScrollView使用自动布局，使其能够滚动" href="http://www.cocoachina.com/ios/20150104/10810.html"><span>Storyboard中的UIScrollView使...</span></a></p></li><li class=""><span class="hide_comment">好</span><br><p><span>nothing123</span><span>评论了</span><a target="_blank" title="Storyboard中的UIScrollView使用自动布局，使其能够滚动" href="http://www.cocoachina.com/ios/20150104/10810.html"><span>Storyboard中的UIScrollView使...</span></a></p></li><li class=""><span class="hide_comment">sb</span><br><p><span>la0fu</span><span>评论了</span><a target="_blank" title="因为A商，互联网的寒冬不再冷" href="http://www.cocoachina.com/industry/20151113/14204.html"><span>因为A商，互联网的寒冬不再冷...</span></a></p></li><li class=""><span class="hide_comment">代码：
Class currentClass &amp;#61; [self class];
    for (int i &amp;#61; 0; i &amp;#60; 10; i++&amp;#41; {
        NSLog(@"Following the isa pointer %d times gives %p", i, currentClass&amp;#41;;
        NSLog(@"classname&amp;#61;%@",NSStringFromClass(currentClass&amp;#41;&amp;#41;;
        currentClass &amp;#61; object_getClass(currentClass&amp;#41;;
    }

结果：
2015-11-14 12:47:43.445 TestLoadView[4531:1078820] Following the isa pointer 0 times gives 0x7f9f58f82d40
2015-11-14 12:47:43.445 TestLoadView[4531:1078820] classname&amp;#61;TestClass
2015-11-14 12:47:43.446 TestLoadView[4531:1078820] Following the isa pointer 1 times gives 0x7f9f58f82d70
2015-11-14 12:47:43.446 TestLoadView[4531:1078820] classname&amp;#61;TestClass
2015-11-14 12:47:43.469 TestLoadView[4531:1078820] Following the isa pointer 2 times gives 0x101dd5d50
2015-11-14 12:47:43.469 TestLoadView[4531:1078820] classname&amp;#61;NSObject
2015-11-14 12:47:43.469 TestLoadView[4531:1078820] Following the isa pointer 3 times gives 0x101dd5d50
2015-11-14 12:47:43.469 TestLoadView[4531:1078820] classname&amp;#61;NSObject
2015-11-14 12:47:43.469 TestLoadView[4531:1078820] Following the isa pointer 4 times gives 0x101dd5d50
2015-11-14 12:47:43.469 TestLoadView[4531:1078820] classname&amp;#61;NSObject
2015-11-14 12:47:43.470 TestLoadView[4531:1078820] Following the isa pointer 5 times gives 0x101dd5d50
2015-11-14 12:47:43.470 TestLoadView[4531:1078820] classname&amp;#61;NSObject
2015-11-14 12:47:43.470 TestLoadView[4531:1078820] Following the isa pointer 6 times gives 0x101dd5d50
2015-11-14 12:47:43.470 TestLoadView[4531:1078820] classname&amp;#61;NSObject
2015-11-14 12:47:43.470 TestLoadView[4531:1078820] Following the isa pointer 7 times gives 0x101dd5d50
2015-11-14 12:47:43.471 TestLoadView[4531:1078820] classname&amp;#61;NSObject
2015-11-14 12:47:43.471 TestLoadView[4531:1078820] Following the isa pointer 8 times gives 0x101dd5d50
2015-11-14 12:47:43.494 TestLoadView[4531:1078820] classname&amp;#61;NSObject
2015-11-14 12:47:43.494 TestLoadView[4531:1078820] Following the isa pointer 9 times gives 0x101dd5d50
2015-11-14 12:47:43.494 TestLoadView[4531:1078820] classname&amp;#61;NSObject


这就说明了NSObject Metal Class的isa指向了自己</span><br><p><span>lengkuazhong</span><span>评论了</span><a target="_blank" title="Objective-C Runtime 运行时之一：类与对象" href="http://www.cocoachina.com/ios/20141031/10105.html"><span>Objective-C Runtime 运行时之一...</span></a></p></li><li class=""><span class="hide_comment">（currentClass &amp;#61; objc_getClass((__bridge void *&amp;#41;currentClass&amp;#41;;）这个语句错了
要用object_getClass才是获取isa的
</span><br><p><span>lengkuazhong</span><span>评论了</span><a target="_blank" title="Objective-C Runtime 运行时之一：类与对象" href="http://www.cocoachina.com/ios/20141031/10105.html"><span>Objective-C Runtime 运行时之一...</span></a></p></li><li class="noborder-b"><span class="hide_comment">楼主总结的不错！</span><br><p><span>yangshu5188</span><span>评论了</span><a target="_blank" title="这8种武器点亮程序员的个人品牌" href="http://www.cocoachina.com/programmer/20151113/14024.html"><span>这8种武器点亮程序员的个人品牌...</span></a></p></li></ul>
                </div>
                <!--./综合评论-->
                <!--相关帖子-->
                <div class="part-wrap clearfix" style="margin:15px 0 15px 0;">
                    <h3>相关帖子</h3>
                    <ul class="related-comment clearfix">
                        <script charset="gb2312" src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/new.html"></script><li><a href="http://www.cocoachina.com/bbs/read.php?tid=331872" target="_blank">EditBox与TextFiled!</a></li><li><a href="http://www.cocoachina.com/bbs/read.php?tid=331871" target="_blank">关于TabBar高度的问题</a></li><li><a href="http://www.cocoachina.com/bbs/read.php?tid=331870" target="_blank">storyboard里的viewcontroller里view上拖进去的控件运行起来看不到?</a></li><li><a href="http://www.cocoachina.com/bbs/read.php?tid=331869" target="_blank">深入iOS语言使用的是消息结构而非函数调用，即iOS的运行期如此动态的原理</a></li><li><a href="http://www.cocoachina.com/bbs/read.php?tid=331868" target="_blank">iOS 类似于小米手环app的通信机制是怎么样的？</a></li><li><a href="http://www.cocoachina.com/bbs/read.php?tid=331867" target="_blank">说说这两个东西区别</a></li><li><a href="http://www.cocoachina.com/bbs/read.php?tid=331866" target="_blank">苹果开发者账号购买退款迟迟不退</a></li><li><a href="http://www.cocoachina.com/bbs/read.php?tid=331865" target="_blank">求助gamecenter获取GKLocalPlayer信息后返回值为nil</a></li><li class="clearfix noborder-b"><a href="http://www.cocoachina.com/bbs/read.php?tid=331864" target="_blank">请教：苹果应用的收入可以结算为人民币吗？</a></li>
                    </ul>
                </div>
                <!--./相关帖子-->
                <iframe class="share_self" scrolling="no" src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/index.html" frameborder="0" height="550" width="230"></iframe>
                <script async="" src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/adsbygoogle.js"></script>
                <!-- CC列表页面230x230 -->
                <ins data-adsbygoogle-status="done" class="adsbygoogle" style="display:inline-block;width:230px;height:230px" data-ad-client="ca-pub-1180518835303646" data-ad-slot="6765277166"><ins id="aswift_3_expand" style="display:inline-table;border:none;height:230px;margin:0;padding:0;position:relative;visibility:visible;width:230px;background-color:transparent"><ins id="aswift_3_anchor" style="display:block;border:none;height:230px;margin:0;padding:0;position:relative;visibility:visible;width:230px;background-color:transparent"><iframe marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_3" name="aswift_3" style="left:0;position:absolute;top:0;" frameborder="0" height="230" width="230"></iframe></ins></ins></ins>
                <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script>
            </div>
        </div>
        <!--./侧边栏-->
    </div>

    <div id="coco-store" style="display:none">
        <div class="storebox">
            <h5>提示</h5>
            <h3>已经收藏该篇文章</h3>
            <p class="p1"><a href="http://www.cocoachina.com/bbs/u.php?action=favor&amp;tag=1" target="_blank">去我的收藏夹</a></p>
            <p class="p2"><a href="http://www.cocoachina.com/bbs/login.php">请登录</a></p>
        </div>
    </div> <!--收藏提示-->
</div>

<script type="text/javascript">

function postDigg(ftype,aid)
{
    var taget_obj = document.getElementById('newdigg');
    var saveid = GetCookie('diggid');
    if(saveid != null)
    {
        var saveids = saveid.split(',');
        var hasid = false;
        saveid = '';
        j = 1;
        for(i=saveids.length-1;i>=0;i--)
        {
            if(saveids[i]==aid && hasid) continue;
            else {
                if(saveids[i]==aid && !hasid) hasid = true;
                saveid += (saveid=='' ? saveids[i] : ','+saveids[i]);
                j++;
                if(j==20 && hasid) break;
                if(j==19 && !hasid) break;
            }
        }
        if(hasid) { alert("您已经顶过该帖，请不要重复顶帖 ！"); return; }
        else saveid += ','+aid;
        SetCookie('diggid',saveid,1);
    }
    else
    {
        SetCookie('diggid',aid,1);
    }
    myajax = new DedeAjax(taget_obj,false,false,'','','');
    var url = "/cms/plus/digg_ajax.php?action="+ftype+"&id="+aid;
    myajax.SendGet2(url);
    DedeXHTTP = null;
    $('#zanbox').addClass('zanbox-selected');
}
function getDigg(aid)
{
    var taget_obj = document.getElementById('newdigg');
    myajax = new DedeAjax(taget_obj,false,false,'','','');
    myajax.SendGet2("/cms/plus/digg_ajax.php?id="+aid);
    DedeXHTTP = null;
}


//显示对应的导航：
$(function(){
    var article_id = $('#article_id').val();
    var saveid = GetCookie('diggid');

    if(saveid != null)
    {
        var saveids = saveid.split(',');
        var hasid = false;
        saveid = '';
        j = 1;
        for(i=saveids.length-1;i>=0;i--)
        {
            if(saveids[i]==article_id && hasid) continue;
            else {
                if(saveids[i]==article_id && !hasid) hasid = true;
                saveid += (saveid=='' ? saveids[i] : ','+saveids[i]);
                j++;
                if(j==20 && hasid) break;
                if(j==19 && !hasid) break;
            }
        }

        if(hasid)
        {
            $('#zanbox').addClass('zanbox-selected');
        }

    }


    // 根据作者名更新链接

    function updateAuthor(name) {
        if(name != "pockry" && name!= "suiling" && name!= "wupeng") {
            name = "suiling";
        }
        var urls = {
            "pockry": "http://www.cocoachina.com/bbs/u.php?action=feed&username=pockry",
            "suiling": "http://www.cocoachina.com/bbs/u.php?action=feed&uid=340873",
            "wupeng": "http://www.cocoachina.com/bbs/u.php?action=feed&uid=304691"
        };
        $("#field_author").attr("href", urls[name]).html(name);
    }
    updateAuthor("suiling");

});

window.onload = function() {

    $('#sharediv').removeClass('bdshare-button-style1-32');
    $('#sharediv').attr('class','bdsharebuttonbox');
};
</script>
<script type="text/javascript" src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/shCore.js"></script>
    <script type="text/javascript" src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/brush.js"></script>
    <link type="text/css" rel="stylesheet" href="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/shCoreDefault.css">
    <script type="text/javascript">
    //SyntaxHighlighter.config.clipboardSwf = '/js/scripts/clipboard.swf';

    SyntaxHighlighter.all();</script>


<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"(译)KVO的内部实现 - 来自CocoaChina苹果开发中文站@CocoaChina","bdMini":"2","bdMiniList":false,"bdPic":"/cms/uploads/allimg/140107/4196-14010GA5290-L.jpg","bdStyle":"1","bdSize":"32"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api//js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
<!--./cont-->

<!-- 回复评论框模板 -->
<script type="text/javascript" src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/comment.js"></script>
<script type="text/javascript" src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/mustache.js"></script>
<!-- 回复评论框模板 -->
<script id="reply_comment_template" type="x-tmpl-mustache">
    <div id="sub-reply-comment" class="reply-comment">
        <textarea name="subcomment" id="sub-reply-txt" cols="30" rows="10" placeholder="你怎么看？快来评论一下吧！"></textarea>
        <input type="hidden" id="sub-reply-id" value="{{commentid}}" />
        <input type="hidden" id="sub-reply-userid" value="{{parentuserid}}" />
        <input type="hidden" id="sub-reply-username" value="{{parentusername}}" />
        <a type="button" id="sub_comment_bt" class="submitbt">提交</a>
        <div class="clearfloat"></div>
        <div class="unlogin-mask">
            <div>您还没有登录！请<a href="/bbs/login.php">登录</a>或<a href="/bbs/register.php">注册</a></div>
        </div>
    </div>
</script>

<!-- 评论模板 -->
<script id="main_comment_template" type="x-tmpl-mustache">
    <div class="glab-comment" rel-data-id="{{comment_id}}" rel-user-id="{{user_id}}" rel-user-name="{{user_name}}" rel-layer="1">
        <div class="comment-left">
            <a href="/bbs/u.php?action=feed&uid={{user_id}}" target="_blank"><img src="{{user_icon_url}}" height="43" width="43" alt=""></a>
        </div>
        <div class="comment-right">
            <div class="comment-author"><a href="/bbs/u.php?action=feed&uid={{user_id}}" target="_blank">{{user_name}}</a><span class="puptime">{{create_time}}</span></div>
            <div class="comment-content">{{content}}</div>
            <div class="comment-buttons">
                <span class="ding">                    
                    <img src="http://cdn.cocimg.com/cms/templets/images/zan-default.png" height="14" width="14" alt="" class="default" style="{{#has_supported}} display:none; {{/has_supported}}">
                    <img src="http://cdn.cocimg.com/cms/templets/images/zan-active.png" height="14" width="14" alt="" class="actived" style="{{^has_supported}} display:none; {{/has_supported}}">
                    <span class="zancnt">{{support}}</span>
                </span>
                <span class="cai">
                    <img src="http://cdn.cocimg.com/cms/templets/images/cai-default.png" height="14" width="14" alt="" class="default" style="{{#has_reported}} display:none; {{/has_reported}}">
                    <img src="http://cdn.cocimg.com/cms/templets/images/cai-active.png" height="14" width="14" alt="" class="actived" style="{{^has_reported}} display:none; {{/has_reported}}">
                    <span class="zancnt">{{report}}</span>
                </span>
                <span class="replybt">回复</span>
            </div>
        </div>
            {{#sub}}
                <div class="glab-comment glab-sub-comment" rel-data-id="{{comment_id}}" rel-user-id="{{user_id}}" rel-user-name="{{user_name}}" rel-layer="2">
                    <div class="comment-left">
                        <a href="/bbs/u.php?action=feed&uid={{user_id}}" target="_blank"><img src="{{user_icon_url}}" height="43" width="43" alt=""></a>
                    </div>
                    <div class="comment-right">
                        <div class="comment-author"><a href="/bbs/u.php?action=feed&uid={{user_id}}" target="_blank">{{user_name}}</a><span class="puptime">{{create_time}}</span></div>
                        <div class="comment-content"><a href="/bbs/u.php?action=feed&uid={{parent_user_id}}" target="_blank">回复：{{parent}}</a>{{content}}</div>
                        <div class="comment-buttons">
                            <span class="ding">
                                <img src="http://cdn.cocimg.com/cms/templets/images/zan-default.png" height="14" width="14" alt="" class="default" style="{{#has_supported}} display:none; {{/has_supported}}">
                                <img src="http://cdn.cocimg.com/cms/templets/images/zan-active.png" height="14" width="14" alt="" class="actived" style="{{^has_supported}} display:none; {{/has_supported}}">
                                <span class="zancnt">{{support}}</span>
                            </span>
                            <span class="cai">
                                <img src="http://cdn.cocimg.com/cms/templets/images/cai-default.png" height="14" width="14" alt="" class="default" style="{{#has_reported}} display:none; {{/has_reported}}">
                                <img src="http://cdn.cocimg.com/cms/templets/images/cai-active.png" height="14" width="14" alt="" class="actived" style="{{^has_reported}} display:none; {{/has_reported}}">
                                <span class="zancnt">{{report}}</span>
                            </span>
                            <span class="replybt">回复</span>
                        </div>          
                    </div>
                </div>
            {{/sub}}         
    </div>  
</script>


<script id="sub_comment_template" type="x-tmpl-mustache">
    <div class="glab-comment glab-sub-comment" rel-data-id="{{comment_id}}" rel-user-id="{{user_id}}" rel-user-name="{{user_name}}" rel-layer="2">
        <div class="comment-left">
            <a href="/bbs/u.php?action=feed&uid={{user_id}}" target="_blank"><img src="{{user_icon_url}}" height="43" width="43" alt=""></a>
        </div>
        <div class="comment-right">
            <div class="comment-author"><a href="/bbs/u.php?action=feed&uid={{user_id}}" target="_blank">{{user_name}}</a><span class="puptime">{{create_time}}</span></div>
            <div class="comment-content"><a href="/bbs/u.php?action=feed&uid={{parent_user_id}}" target="_blank">回复：{{parent}}</a>{{content}}</div>
            <div class="comment-buttons">
                <span class="ding">
                    <img src="http://cdn.cocimg.com/cms/templets/images/zan-default.png" height="14" width="14" alt="" class="default" style="{{#has_supported}} display:none; {{/has_supported}}">
                    <img src="http://cdn.cocimg.com/cms/templets/images/zan-active.png" height="14" width="14" alt="" class="actived" style="{{^has_supported}} display:none; {{/has_supported}}">
                    <span class="zancnt">{{support}}</span>
                </span>
                <span class="cai">
                    <img src="http://cdn.cocimg.com/cms/templets/images/cai-default.png" height="14" width="14" alt="" class="default" style="{{#has_reported}} display:none; {{/has_reported}}">
                    <img src="http://cdn.cocimg.com/cms/templets/images/cai-active.png" height="14" width="14" alt="" class="actived" style="{{^has_reported}} display:none; {{/has_reported}}">
                    <span class="zancnt">{{report}}</span>
                </span>
                <span class="replybt">回复</span>
            </div>          
        </div>
    </div>
</script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-68948817-1', 'auto', {'name': 'newTracker'});
  ga('newTracker.send', 'pageview');

</script>
<!--右侧浮动-->
<div style="position: fixed; top: inherit; bottom: 10px;" class="r-bar">
    <img src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/coco_weixin.png" class="weixin">
    <a href="http://weibo.com/cocoachina" target="_blank" title="" class="weibo">sina</a>
    <a href="javascript:void(0);" target="_blank" title="" class="feedback">weixin</a>
    <a href="mailto:support@cocoachina.com" title="" class="kefu">mail</a>
    <a style="display: inline;" href="javascript:;" title="回到顶部" class="returntop">回到顶部</a>
</div>

<!--./cont-->
<script type="text/javascript" src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/index.js"></script>
<script language="javascript" src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/bbsauth_plus2015.html" type="text/javascript"></script>
<script src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/jquery_002.js" type="text/javascript"></script>
<script src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/script.js" type="text/javascript"></script>

<!--footer-->
<div class="footer clearfix">
    <!--<div class="footer-t">
        <div class="friend-link">
            <h4 class="rank-tit">友情链接</h4>
            <ul>
                <li><a href="https://www.youmi.net/" target="_blank">有米 | </a></li><li><a href="http://www.testin.cn/" target="_blank">Testin | </a></li><li><a href="http://www.apicloud.com/" target="_blank">APICloud | </a></li><li><a href="http://www.oneapm.com" target="_blank">OneAPM | </a></li><li><a href="http://www.jpush.cn" target="_blank">极光推送 | </a></li><li><a href="https://store.cocos.com" target="_blank">Cocos商店 | </a></li><li><a href="http://www.woshipm.com/" target="_blank">人人都是产品经理 | </a></li><li><a href="http://link.cocos.com" target="_blank">Cocos Link | </a></li><li><a href="http://www.tuicool.com/" target="_blank">推酷网 | </a></li><li><a href="http://www.youxituoluo.com/" target="_blank">游戏陀螺 | </a></li><li><a href="http://www.9miao.com" target="_blank">9秒社团 | </a></li><li><a href="http://segmentfault.com/" target="_blank">SegmentFault | </a></li><li><a href="http://www.sykong.com/" target="_blank">手游那点事 | </a></li><li><a href="https://developer.apple.com/" target="_blank">苹果开发者中心 | </a></li><li><a href="http://www.cocos2d-x.org/" target="_blank">cocos2d-x | </a></li><li><a href="http://gamerboom.com/" target="_blank">游戏邦 | </a></li><li><a href="http://www.nooidea.com/" target="_blank">Nooidea.com | </a></li><li><a href="http://www.iapps.im/" target="_blank">爱应用</a></li>
            </ul>
        </div>
        <div class="two-code">
            <div class="wx-code">
                <img src="http://cdn.cocimg.com/assets/images/wx-code.jpg?v=20150818" alt="" />
                <span>关注微信 每日推荐</span>
            </div>
            <div class="m-code">
                <img src="http://cdn.cocimg.com/assets/images/mb-code.jpg?v=20150818" alt="" />
                <span>扫一扫 浏览移动版</span>
            </div>
        </div>
    </div>-->
    <div class="footer-b">
        <div>
            <a href="http://www.cocoachina.com/aboutus/index.html" target="_blank">关于我们</a>
            <a href="http://www.cocoachina.com/contactus/" target="_blank">商务合作</a>
            <a target="_blank" href="mailto:support@cocoachina.com">联系我们</a>
            <a href="http://www.cocoachina.com/corps/" target="_blank">合作伙伴</a>
        </div>
        <p class="footer-b-p">北京触控科技有限公司版权所有</p>
        <p>
            ©2015 Chukong Technologies,Inc.
            <i>
                <a href="http://www.miibeian.gov.cn/" target="_blank">京ICP备 11006519号 　京ICP证 100954号</a> 京公网安备11010502020289
                <a href="http://182.131.21.137/ccnt-apply/admin/business/preview/business-preview%21lookUrlRFID.action?main_id=A580B24B1AE846CE9DA949026D63939F" target="_blank">
                    <img src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/jingwen.png" style="margin: -10px auto -14px -10px;">
                    京网文[2012]0426-138号
                </a>
            </i>
        </p>
    </div>
</div>

<!--./footer-->
<script language="javascript" type="text/javascript" src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/dedeajax2-min.js"></script>
<script type="text/javascript">
function subscribe()
{
    var email_address = $('#demail').val();
    var preg_email = /^([\.a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/;

    if( email_address == '' )
    {
        alert('请输入邮箱');
    }
    else if( !preg_email.test(email_address) )
    {
        alert('邮箱格式错误');
    }
    else
    {
        $.post(
            '/edm.php',
            {
                email: $('#demail').val()
            },
            function(data) {
                alert(data);
             });
    }
}
function search_check()
{
    var search_keyword = $('#search_keyword').val();

    if( search_keyword.length < 2 )
    {
        alert("搜索关键字不能少于2个字节，请重新输入。");
    }
    else
    {
        $('#searchform').submit();
    }
}

var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "http://hm.baidu.com/hm.js?88399e4c4cf744609c4fc8c3a8935691";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();

$(document).ready(function(){
    if (typeof(_user_info_html) != 'undefined' && _user_info_html)
    {
        $('.nav-user-login').hide();
        $('.nav-user-name').html(_user_info_html).show();
    }

    var type = $('#type_name').html();
    if(type)
    {
        switch( type )
        {
            case 'iOS开发':
                $('#ios').addClass('light');
                break;
            case 'AppStore研究':
                $('#app_store').addClass('light');
                break;
            case 'Mac开发':
                $('#mac').addClass('light');
                break;
            case '产品设计':
                $('#design').addClass('light');
                break;
            case 'Cocos引擎':
                $('#cocos').addClass('light');
                break;
            case 'WebApp':
                $('#webapp').addClass('light');
                break;
            case 'Swift':
                $('#swift').addClass('light');
                break;
            case '游戏开发':
                $('#game').addClass('light');
                break;
            case '苹果相关':
                $('#apple').addClass('light');
                break;
            case '营销推广':
                $('#market').addClass('light');
                break;
            case '业界动态':
                $('#industry').addClass('light');
                break;
            case '程序人生':
                $('#programmer').addClass('light');
                break;
        }
    }

    //更改文章来源
    var source = $('#source a').html();
    if( source == '未知' )
        jQuery('#source a').html('CocoaChina');
    if( jQuery('#source a').attr('href')=='')
        jQuery('#source').html('来源：'+source);

    //获取用户登录的id
    var content = jQuery('.t-lid').attr("href");
    var uid = 0;
    if( content )
    {
        content = content.split('=');
        uid = content[1];
    }

    var timestamp = new Date().getTime();
    var uid_int = parseInt(uid);
    if (uid_int == uid && uid_int != 0) {
        uid = uid_int;
    } else {
        uid = parseInt($('#user-info').attr('data-uid'));
    }
    if ( uid )
    {
        uid = uid<<2;
        uid = uid+''+timestamp;
    } else {
        uid = '';
    }

    var oIframe=document.getElementById("comiframe");
    if(oIframe){
        var oUrl=window.location.href;
        oUrl = encodeURIComponent(oUrl);

        oIframe.src="/comment.php?url="+oUrl+"&uid="+uid;
    }

});
</script>
<script>CNZZ_SLOT_RENDER('337970');</script><script type="text/javascript" charset="gbk" src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/appgcm.js"></script><div id="cnzz_slot_337970" style="width:-1px;height:-1px;border:none;margin:0px;padding:0px;background-color:#FFFFFF;overflow:hidden;"></div>
<div style="display:none"><a target="_blank" key="52df886aaf60041470116076" logo_size="83x30" logo_type="official" href="http://www.anquan.org/authenticate/cert/?site=www.cocoachina.com&amp;at=official">
<script src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/aq_auth.js"></script><span style="display:none;" class="LOGO_aq_jsonp_wrap_" id="AQ_logo_span_init_1"><script async="true" type="text/javascript" src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/a.js"></script></span><img alt="安全联盟认证" style="border: medium none;" src="%28%E8%AF%91%29KVO%E7%9A%84%E5%86%85%E9%83%A8%E5%AE%9E%E7%8E%B0_files/gw_83x30_gray.png" height="30" width="83"></a></div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-16940817-2', 'auto');
  ga('send', 'pageview');

</script>


<div style="display: none;" id="cboxOverlay"></div><div style="display: none;" class="" id="colorbox"><div id="cboxWrapper"><div><div style="float: left;" id="cboxTopLeft"></div><div style="float: left;" id="cboxTopCenter"></div><div style="float: left;" id="cboxTopRight"></div></div><div style="clear: left;"><div style="float: left;" id="cboxMiddleLeft"></div><div style="float: left;" id="cboxContent"><div style="width: 0px; height: 0px; overflow: hidden; float: left;" id="cboxLoadedContent"></div><div style="float: left;" id="cboxLoadingOverlay"></div><div style="float: left;" id="cboxLoadingGraphic"></div><div style="float: left;" id="cboxTitle"></div><div style="float: left;" id="cboxCurrent"></div><div style="float: left;" id="cboxNext"></div><div style="float: left;" id="cboxPrevious"></div><div style="float: left;" id="cboxSlideshow"></div><div style="float: left;" id="cboxClose"></div></div><div style="float: left;" id="cboxMiddleRight"></div></div><div style="clear: left;"><div style="float: left;" id="cboxBottomLeft"></div><div style="float: left;" id="cboxBottomCenter"></div><div style="float: left;" id="cboxBottomRight"></div></div></div><div style="position: absolute; width: 9999px; visibility: hidden; display: none;"></div></div></body></html>