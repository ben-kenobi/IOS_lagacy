<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-cn" xml:lang="zh-cn">
  <head>
    <title>Sequence | Swifter - 100 个 Swift 必备 Tips (第二版)</title>
    <meta content="" name="description"/>
    <meta content="GitBook 2.2.0" name="generator"/>
    <meta content="王巍 (onevcat)" name="author"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre">
        
        
<div class="page">
    <h1 class="book-chapter" id="calibre_toc_6">Sequence</h1>
    
        <div class="normal" id="section-">
        
            <h1 id="sequence" class="calibre1">Sequence</h1>
<p class="calibre9">Swift 的 <code class="calibre13 pcalibre6 pcalibre5">for...in</code> 可以用在所有实现了 <code class="calibre13 pcalibre6 pcalibre5">SequenceType</code> 的类型上，而为了实现 <code class="calibre13 pcalibre6 pcalibre5">SequenceType</code> 你首先需要实现一个 <code class="calibre13 pcalibre6 pcalibre5">GeneratorType</code>。比如一个实现了反向的 <code class="calibre13 pcalibre6 pcalibre5">generator</code> 和 <code class="calibre13 pcalibre6 pcalibre5">sequence</code> 可以这么写：</p>
<pre class="calibre12"><code class="pcalibre3 lang-swift pcalibre4"><span class="hljs-title">// 先定义一个实现了 GeneratorType protocol 的类型</span>
<span class="hljs-title">// GeneratorType 需要指定一个 typealias Element</span>
<span class="hljs-title">// 以及提供一个返回 Element? 的方法 next()</span>
<span class="hljs-func"><span class="hljs-keyword">class</span> <span class="hljs-title">ReverseGenerator</span>: <span class="hljs-title">GeneratorType</span> </span>{
    <span class="hljs-keyword">typealias</span> <span class="hljs-func">Element</span> = <span class="hljs-func">Int</span>

    <span class="hljs-keyword">var</span> counter: <span class="hljs-func">Element</span>
    <span class="hljs-keyword">init</span>&lt;<span class="hljs-func">T</span>&gt;(array: [<span class="hljs-func">T</span>]) {
        <span class="hljs-keyword">self</span>.counter = array.<span class="hljs-params">count</span> - <span class="hljs-params">1</span>
    }

    <span class="hljs-keyword">init</span>(start: <span class="hljs-func">Int</span>) {
        <span class="hljs-keyword">self</span>.counter = start
    }

    <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">next</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-func">Element</span>? {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.counter &lt; <span class="hljs-params">0</span> ? <span class="hljs-params">nil</span> : counter--
    }
}

<span class="hljs-title">// 然后我们来定义 SequenceType</span>
<span class="hljs-title">// 和 GeneratorType 很类似，不过换成指定一个 typealias Generator</span>
<span class="hljs-title">// 以及提供一个返回 Generator? 的方法 generate()</span>
<span class="hljs-func"><span class="hljs-keyword">struct</span> <span class="hljs-title">ReverseSequence</span>&lt;<span class="hljs-title">T</span>&gt;: <span class="hljs-title">SequenceType</span> </span>{
    <span class="hljs-keyword">var</span> array: [<span class="hljs-func">T</span>]

    <span class="hljs-keyword">init</span> (array: [<span class="hljs-func">T</span>]) {
        <span class="hljs-keyword">self</span>.array = array
    }

    <span class="hljs-keyword">typealias</span> <span class="hljs-func">Generator</span> = <span class="hljs-func">ReverseGenerator</span>
    <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">generate</span><span class="hljs-params">()</span></span> -&gt; <span class="hljs-func">Generator</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-func">ReverseGenerator</span>(array: array)
    }
}

<span class="hljs-keyword">let</span> arr = [<span class="hljs-params">0</span>,<span class="hljs-params">1</span>,<span class="hljs-params">2</span>,<span class="hljs-params">3</span>,<span class="hljs-params">4</span>]

<span class="hljs-title">// 对 SequenceType 可以使用 for...in 来循环访问</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-func">ReverseSequence</span>(array: arr) {
    <span class="hljs-params">print</span>(<span class="hljs-string">"Index <span class="hljs-func">\(i)</span> is <span class="hljs-func">\(arr[i])</span>"</span>)
}
</code></pre>
<p class="calibre9">输出为</p>
<pre class="calibre12"><code class="pcalibre3 lang-swift pcalibre4">Index 4 is 4
Index 3 is 3
Index 2 is 2
Index 1 is 1
Index 0 is 0
</code></pre><p class="calibre9">如果我们想要深究 <code class="calibre13 pcalibre6 pcalibre5">for...in</code> 这样的方法到底做了什么的话，如果我们将其展开，大概会是下面这个样子：</p>
<pre class="calibre12"><code class="pcalibre3 lang-swift pcalibre4"><span class="hljs-keyword">var</span> g = array.generate()
<span class="hljs-keyword">while</span> <span class="hljs-keyword">let</span> obj = g.next() {
    <span class="hljs-params">print</span>(obj)
}
</code></pre>
<p class="calibre9">顺便你可以免费得到的收益是你可以使用像 <code class="calibre13 pcalibre6 pcalibre5">map</code> , <code class="calibre13 pcalibre6 pcalibre5">filter</code> 和 <code class="calibre13 pcalibre6 pcalibre5">reduce</code> 这些方法，因为 <code class="calibre13 pcalibre6 pcalibre5">SequenceType</code> 接口扩展 (protocol extension) 已经实现了它们：</p>
<blockquote class="calibre6">
<pre class="calibre14"><code class="pcalibre3 lang-swift pcalibre4"><span class="hljs-func"><span class="hljs-keyword">extension</span> <span class="hljs-title">SequenceType</span> </span>{
    <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">map</span><span class="hljs-func">&lt;T&gt;</span><span class="hljs-params">(@noescape transform: <span class="hljs-params">(<span class="hljs-keyword">Self</span>.Generator.Element)</span></span></span> -&gt; <span class="hljs-func">T</span>) -&gt; [<span class="hljs-func">T</span>]
    <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">filter</span><span class="hljs-params">(@noescape includeElement: <span class="hljs-params">(<span class="hljs-keyword">Self</span>.Generator.Element)</span></span></span> -&gt; <span class="hljs-func">Bool</span>) 
                                -&gt; [<span class="hljs-func">Self</span>.<span class="hljs-func">Generator</span>.<span class="hljs-func">Element</span>]
    <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">reduce</span><span class="hljs-func">&lt;T&gt;</span><span class="hljs-params">(initial: T, 
         @noescape combine: <span class="hljs-params">(T, <span class="hljs-keyword">Self</span>.Generator.Element)</span></span></span> -&gt; <span class="hljs-func">T</span>) -&gt; <span class="hljs-func">T</span>
</code></pre>
</blockquote>

        
        </div>
    
</div>

        
        
    
    

</body></html>
